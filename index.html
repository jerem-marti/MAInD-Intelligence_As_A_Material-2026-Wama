<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>MAInD Wama - Smart Sink Companion</title>
    
    <!-- iOS PWA Support for Fullscreen Mode -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Wama">
    <meta name="mobile-web-app-capable" content="yes">
    
    <!-- Fonts -->
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Proto+Mono:wght@400;500;600;700&display=swap">
    
    <!-- External Libraries -->
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@1.7.4/dist/tf.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@teachablemachine/image@0.8.4/dist/teachablemachine-image.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/hands/hands.js" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/lottie-web/5.12.2/lottie.min.js"></script>
    
    <!-- Styles -->
    <link rel="stylesheet" href="css/main.css">
    <link rel="stylesheet" href="css/pages.css">
    <link rel="stylesheet" href="css/animations.css">
    <link rel="stylesheet" href="css/debug.css">
</head>
<body>
    <!-- Main Application Container -->
    <div id="app">
        <!-- Header -->
        <header id="app-header" class="app-header hidden">
            <h1 class="title" id="page-title">MAInD Wama</h1>
        </header>

        <!-- Page Container (SPA views render here) -->
        <main id="page-container"></main>

        <!-- Lottie Animation Container -->
        <div id="lottie-container"></div>
        
        <!-- Background Lottie (for waves, etc.) -->
        <div id="bg-lottie"></div>

        <!-- Debug Panel (collapsible) -->
        <details id="debug-panel" class="debug-panel">
            <summary>Debug Info</summary>
            <div class="debug-content">
                <div class="debug-section-title">State Model</div>
                <div id="debug-probabilities"></div>

                <div class="debug-section-title">Prediction Buffer</div>
                <div id="debug-buffer-votes" class="debug-buffer">-</div>

                <div class="debug-section-title">Gesture Detection (MediaPipe Hands)</div>
                <div class="debug-grid">
                    <div class="debug-item">
                        <span class="debug-label">Active:</span>
                        <span id="debug-gesture-active" class="debug-value">OFF</span>
                    </div>
                    <div class="debug-item">
                        <span class="debug-label">Hand:</span>
                        <span id="debug-hand-detected" class="debug-value">-</span>
                    </div>
                    <div class="debug-item">
                        <span class="debug-label">Current:</span>
                        <span id="debug-current-gesture" class="debug-value">-</span>
                    </div>
                    <div class="debug-item">
                        <span class="debug-label">Hold:</span>
                        <span id="debug-hold-duration" class="debug-value">0ms</span>
                    </div>
                </div>
                <div id="debug-gesture-bars"></div>

                <div class="debug-section-title">Music Flow</div>
                <div class="debug-grid">
                    <div class="debug-item">
                        <span class="debug-label">Question Timer:</span>
                        <span id="debug-question-timer" class="debug-value">-</span>
                    </div>
                    <div class="debug-item">
                        <span class="debug-label">Music Response:</span>
                        <span id="debug-music-response" class="debug-value">-</span>
                    </div>
                </div>

                <div class="debug-section-title">Current State</div>
                <div class="debug-grid">
                    <div class="debug-item">
                        <span class="debug-label">Route:</span>
                        <span id="debug-current-route" class="debug-value">-</span>
                    </div>
                    <div class="debug-item">
                        <span class="debug-label">ML Class:</span>
                        <span id="debug-ml-class" class="debug-value">-</span>
                    </div>
                    <div class="debug-item">
                        <span class="debug-label">Task Duration:</span>
                        <span id="debug-task-duration" class="debug-value">-</span>
                    </div>
                    <div class="debug-item">
                        <span class="debug-label">FPS:</span>
                        <span id="debug-fps" class="debug-value">-</span>
                    </div>
                </div>

                <div class="debug-section-title">Audio Test</div>
                <div class="debug-audio-buttons">
                    <button class="debug-btn" onclick="document.getElementById('audio-music').play()">üéµ Music</button>
                    <button class="debug-btn" onclick="document.getElementById('audio-askmusic').play()">‚ùì AskMusic</button>
                    <button class="debug-btn" onclick="document.getElementById('audio-hello').play()">üëã Hello</button>
                    <button class="debug-btn" onclick="document.getElementById('audio-howareyou').play()">ü§î HowAreYou</button>
                    <button class="debug-btn" onclick="document.getElementById('audio-youreback').play()">üîô YoureBack</button>
                    <button class="debug-btn" onclick="document.getElementById('audio-bye').play()">üëã Bye</button>
                    <button class="debug-btn" onclick="document.getElementById('audio-worried').play()">üòü Worried</button>
                    <button class="debug-btn" onclick="document.querySelectorAll('audio').forEach(a => { a.pause(); a.currentTime = 0; })">‚èπÔ∏è Stop All</button>
                </div>

                <div class="debug-section-title">üñêÔ∏è Gesture Test Mode</div>
                <div class="debug-grid">
                    <div class="debug-item" style="grid-column: span 2;">
                        <label>
                            <input type="checkbox" id="debug-gesture-test-mode" onchange="window.appController?.toggleGestureTestMode(this.checked)">
                            <span class="debug-label">Enable Gesture Test (Pause Flow)</span>
                        </label>
                    </div>
                </div>
                <div id="gesture-test-result" class="gesture-test-result" style="display: none;">
                    <div class="gesture-test-icon" id="gesture-test-icon">üñêÔ∏è</div>
                    <div class="gesture-test-label" id="gesture-test-label">Waiting for gesture...</div>
                </div>

                <div class="debug-section-title">üéÆ Simulation Mode</div>
                <div class="debug-grid">
                    <div class="debug-item" style="grid-column: span 2;">
                        <label>
                            <input type="checkbox" id="debug-simulation-mode" onchange="window.debugSimulation?.toggleSimulation(this.checked)">
                            <span class="debug-label">Enable Simulation (Override ML)</span>
                        </label>
                    </div>
                </div>
                <div class="debug-audio-buttons" style="margin-top: 8px;">
                    <span class="debug-label" style="width: 100%; margin-bottom: 4px;">Fake ML Class:</span>
                    <button class="debug-btn sim-btn" onclick="window.debugSimulation?.setClass(1)">C1 Idle</button>
                    <button class="debug-btn sim-btn" onclick="window.debugSimulation?.setClass(2)">C2 Person</button>
                    <button class="debug-btn sim-btn" onclick="window.debugSimulation?.setClass(3)">C3 Task</button>
                    <button class="debug-btn sim-btn" onclick="window.debugSimulation?.setClass(4)">C4 Interrupt</button>
                </div>
                <div class="debug-audio-buttons" style="margin-top: 8px;">
                    <span class="debug-label" style="width: 100%; margin-bottom: 4px;">Fake Gesture:</span>
                    <button class="debug-btn sim-btn" onclick="window.debugSimulation?.setGesture('thumbs_up')">üëç Thumbs Up</button>
                    <button class="debug-btn sim-btn" onclick="window.debugSimulation?.setGesture('thumbs_down')">üëé Thumbs Down</button>
                    <button class="debug-btn sim-btn" onclick="window.debugSimulation?.setGesture(null)">‚úã No Gesture</button>
                </div>
            </div>
        </details>
    </div>

    <!-- Audio Elements -->
    <!-- Music: tries local file first, falls back to CDN if local fails -->
    <audio id="audio-music" preload="auto">
        <source src="assets/audio/music.mp3" type="audio/mpeg">
        <source src="https://cdn.pixabay.com/audio/2025/04/15/audio_8a617c91e2.mp3" type="audio/mpeg">
    </audio>
    <audio id="audio-askmusic" src="https://cdn.pixabay.com/audio/2025/05/29/audio_5ca2676796.mp3" preload="auto"></audio>
    <audio id="audio-hello" src="https://cdn.pixabay.com/audio/2025/05/29/audio_145c0e7b22.mp3" preload="auto"></audio>
    <audio id="audio-howareyou" src="https://cdn.pixabay.com/audio/2025/09/18/audio_37de472eec.mp3" preload="auto"></audio>
    <audio id="audio-bye" src="https://cdn.pixabay.com/audio/2023/09/30/audio_b3d6b91910.mp3" preload="auto"></audio>
    <audio id="audio-worried" src="https://cdn.pixabay.com/audio/2024/10/25/audio_66d1f8e5fd.mp3" preload="auto" loop></audio>
    <audio id="audio-youreback" src="https://cdn.pixabay.com/audio/2025/05/29/audio_145c0e7b22.mp3" preload="auto"></audio>

    <!-- Hidden Webcam Container (for ML processing) -->
    <div id="webcam-container" class="webcam-hidden"></div>

    <!-- Application Modules -->
    <script type="module" src="js/main.js"></script>
</body>
</html>
